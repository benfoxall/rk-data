<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>RK Data</title>
    <link rel="stylesheet" href="style.css">
  </head>
  <body>
    <div class="container">
      <header>

        {{^user}}

          <p>
            <a href="/auth/runkeeper">sign in with runkeeper</a>
          </p>
        {{/user}}

        {{#user}}
          <img class="avatar" src="/picture" width="72" height="72">
          <h3>
            {{name}}
          </h3>
          <p>
            <a href="/logout">sign out</a>
          </p>
        {{/user}}
      </header>




      {{#user}}
        <pre id="output"></pre>

        <script type="text/javascript" src="bower_components/reqwest/reqwest.min.js"></script>
        <script type="text/javascript">

          function request(url, count) {
            count--;

            reqwest(url)
              .then(function(res){
                if(res.next && count > 0){
                    request('/data' + res.next, count)
                }

                output.innerText += res.items.map(function(i){
                  return [
                    i.type,
                    (i.total_distance/1000).toPrecision(2) + 'km',
                    i.start_time
                  ].join('\t')
                }).join('\n') + '\n\n';
              })
          }
          
          request('/data/fitnessActivities', 20)

        </script>
      {{/user}}

    </div>

  </body>
</html>
